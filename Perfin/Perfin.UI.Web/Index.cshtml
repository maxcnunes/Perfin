@using System.Web.Optimization
<!DOCTYPE html>
<html>
<head>
    <title>Perfin</title>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="apple-touch-startup-image" href="~/Content/images/ios-startup-image-landscape.png" media="(orientation:landscape)" />
    <link rel="apple-touch-startup-image" href="~/Content/images/ios-startup-image-portrait.png" media="(orientation:portrait)" />
    <link rel="apple-touch-icon" href="~/Content/images/icon.png" />

    <!-- Including Lobster and Cabin from Google Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Lobster|Cabin" rel="stylesheet" type="text/css">

    <!-- Load CSS files -->
    @Styles.Render("~/Content/css")

    <script type="text/javascript">
        if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
            var msViewportStyle = document.createElement("style");
            var mq = "@@-ms-viewport{width:auto!important}";
            msViewportStyle.appendChild(document.createTextNode(mq));
            document.getElementsByTagName("head")[0].appendChild(msViewportStyle);
        }
    </script>

    @Scripts.Render("~/bundles/modernizr")
</head>
<body>
    <div id="applicationHost">
        @RenderPage("_splash.cshtml")
    </div>

    @Scripts.Render("~/scripts/vendor")

    @if (HttpContext.Current.IsDebuggingEnabled)
    {
        <script type="text/javascript" src="~/App/durandal/amd/require.js" data-main="/App/main"></script>
    }
    else
    {
        <script type="text/javascript" src="~/App/main-built.js"></script>
    }
</body>
    <script type="text/javascript">
        $(function () {
            var access_token = /access_token=([^&]*)/g.exec(window.location.hash);
            if (access_token) {
                $.ajax({
                    url: 'https://api.auth0.com/userinfo?access_token=' + access_token[1],
                    dataType: 'json',
                    success: function (data, status, jqHXR) {
                        $('#userinfo').text(JSON.stringify(data, 0, 2));
                    },
                    error: function (resp) {
                        if (resp.status == 401) {
                            $('#userinfo').text('Unauthorized');
                        } else {
                            $('#userinfo').text('Error');
                        }

                    }
                });
            }

            var id_token = /id_token=([^&]*)/g.exec(window.location.hash);
            $(document).on('click', '#get-customers', function () {
                $.ajax({
                    url: '/api/user',
                    dataType: 'json',
                    beforeSend: function (request) {
                        //if (id_token) request.setRequestHeader("Authorization", "Bearer " + id_token[1]);
                    },
                    success: function (data, status, jqHXR) {
                        $('#customers').text(JSON.stringify(data));
                    },
                    error: function (resp) {
                        if (resp.status == 401) {
                            $('#customers').text('Unauthorized');
                        } else {
                            $('#customers').text('Error');
                        }

                    }
                });
            });
        });
</script>
</html>
